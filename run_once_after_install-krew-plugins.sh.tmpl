#!/usr/bin/env bash
{{ if eq .chezmoi.os "darwin" -}}
set -euo pipefail

echo "üì¶ Installing krew plugins..."

# Ensure krew is in PATH
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"

if ! command -v kubectl-krew &>/dev/null; then
  echo "‚ö†Ô∏è  krew not found, skipping plugin installation"
  exit 0
fi

# Install oidc-login plugin
if ! kubectl krew list | grep -q "oidc-login"; then
  echo "Installing oidc-login plugin..."
  kubectl krew install oidc-login
  echo "‚úÖ oidc-login installed"
else
  echo "‚úÖ oidc-login already installed"
fi

echo "‚úÖ Krew plugins configured!"
{{ else -}}
echo "‚ö†Ô∏è  Krew plugin setup is macOS-only"
exit 0
{{ end -}}

