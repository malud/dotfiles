#!/usr/bin/env bash
set -euo pipefail

echo "üì¶ Installing krew plugins..."

# Check if kubectl is available
if ! command -v kubectl &>/dev/null; then
  echo "‚ö†Ô∏è  kubectl not found, skipping krew plugin installation"
  exit 0
fi

# Ensure krew is in PATH
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"

# Wait a moment for krew to be available (in case it was just installed)
sleep 2

if ! command -v kubectl-krew &>/dev/null; then
  echo "‚ö†Ô∏è  krew not found, skipping plugin installation"
  echo "‚ÑπÔ∏è  Please ensure krew is installed properly"
  exit 0
fi

# Install oidc-login plugin
if ! kubectl krew list | grep -q "oidc-login"; then
  echo "Installing oidc-login plugin..."
  kubectl krew install oidc-login
  echo "‚úÖ oidc-login installed"
else
  echo "‚úÖ oidc-login already installed"
fi

echo "‚úÖ Krew plugins configured!"

