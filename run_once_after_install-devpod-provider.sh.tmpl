{{ if eq .chezmoi.os "darwin" -}}
#!/usr/bin/env bash
# Install devpod docker provider (macOS only)

set -e

if ! command -v devpod &>/dev/null; then
  echo "devpod not found, skipping provider installation"
  exit 0
fi

# Check if docker provider is already installed
if devpod provider list | grep -q "docker"; then
  echo "devpod docker provider already installed, skipping"
  exit 0
fi

echo "Adding devpod docker provider..."
devpod provider add https://raw.githubusercontent.com/loft-sh/devpod/refs/heads/main/providers/docker/provider.yaml

echo "✓ devpod docker provider installed"

# Disable telemetry
echo "Disabling telemetry..."
devpod context set-options -o TELEMETRY=false

# Set default IDE (can be overridden per workspace with --ide flag)
# Options: goland, pycharm, intellij, vscode, none, etc.
# Using 'none' allows manual IDE selection per workspace
DEFAULT_IDE="${DEVPOD_DEFAULT_IDE:-none}"
echo "Setting default IDE to: $DEFAULT_IDE"
devpod ide use "$DEFAULT_IDE"

echo "✓ devpod configured (telemetry disabled, IDE: $DEFAULT_IDE)"
echo "ℹ️  Use 'devpod up --ide goland' to override IDE per workspace"

{{ end -}}
