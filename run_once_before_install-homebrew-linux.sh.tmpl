#!/usr/bin/env bash
{{ if ne .chezmoi.os "darwin" -}}
set -euo pipefail

# Check if Homebrew is already installed
if [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
  echo "‚úÖ Homebrew already installed"
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  exit 0
fi

echo "üì¶ Installing Homebrew on Linux..."

# Install build-essential first if on Debian/Ubuntu
if command -v apt-get &>/dev/null && command -v sudo &>/dev/null; then
  echo "üì¶ Installing build-essential (required for Homebrew)..."
  sudo apt-get update -qq
  sudo apt-get install -y -qq build-essential curl git procps file
fi

# Install Homebrew
NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Verify installation and add to PATH
if [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

  # Install GCC as recommended
  echo "üì¶ Installing GCC (recommended by Homebrew)..."
  /home/linuxbrew/.linuxbrew/bin/brew install gcc

  echo "‚úÖ Homebrew installed successfully!"
  echo "‚ÑπÔ∏è  brew is now available: $(command -v brew)"
else
  echo "‚ùå Homebrew installation failed"
  exit 1
fi

{{ else -}}
echo "‚ÑπÔ∏è  This script is for Linux only - skipping on macOS"
exit 0
{{ end -}}

