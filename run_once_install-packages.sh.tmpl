#!/usr/bin/env bash
set -euo pipefail

# Check if Homebrew is available (works on both macOS and Linux)
if command -v brew &>/dev/null; then
  echo "üì¶ Installing Brewfile packages via Homebrew..."

  # Ensure Homebrew is in PATH
  if [ -f /opt/homebrew/bin/brew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [ -f /usr/local/bin/brew ]; then
    eval "$(/usr/local/bin/brew shellenv)"
  elif [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  fi

  brew bundle --file="${HOME}/.Brewfile"

  echo "‚úÖ Homebrew packages installed!"
else
{{ if eq .chezmoi.os "darwin" -}}
  echo "‚ö†Ô∏è  Homebrew not found on macOS - please install it first"
  exit 1
{{ else -}}
  echo "‚ÑπÔ∏è  Homebrew not found - will use native package managers"
  exit 0
{{ end -}}
fi

