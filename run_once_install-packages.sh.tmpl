#!/usr/bin/env bash
set -euo pipefail

# Detect Homebrew location and ensure it's in PATH
BREW_PATH=""
if [ -f /opt/homebrew/bin/brew ]; then
  BREW_PATH="/opt/homebrew/bin/brew"
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [ -f /usr/local/bin/brew ]; then
  BREW_PATH="/usr/local/bin/brew"
  eval "$(/usr/local/bin/brew shellenv)"
elif [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
  BREW_PATH="/home/linuxbrew/.linuxbrew/bin/brew"
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# Check if Homebrew is available
if [ -n "$BREW_PATH" ]; then
  echo "üì¶ Installing Brewfile packages via Homebrew..."
  echo "‚ÑπÔ∏è  Using brew at: $BREW_PATH"

  brew bundle --file="${HOME}/.Brewfile"

  echo "‚úÖ Homebrew packages installed!"
else
{{ if eq .chezmoi.os "darwin" -}}
  echo "‚ö†Ô∏è  Homebrew not found on macOS - please install it first"
  exit 1
{{ else -}}
  echo "‚ÑπÔ∏è  Homebrew not found - will use native package managers"
  exit 0
{{ end -}}
fi

