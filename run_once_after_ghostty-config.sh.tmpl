#!/usr/bin/env bash
{{ if eq .chezmoi.os "darwin" -}}
set -euo pipefail

# Create the Ghostty config directory in Application Support
GHOSTTY_DIR="$HOME/Library/Application Support/com.mitchellh.ghostty"
mkdir -p "$GHOSTTY_DIR"

# Create ~/.config/ghostty for chezmoi-managed files
mkdir -p "$HOME/.config/ghostty/themes"

# Remove existing config if it's not a symlink
if [ -f "$GHOSTTY_DIR/config" ] && [ ! -L "$GHOSTTY_DIR/config" ]; then
    rm "$GHOSTTY_DIR/config"
fi

# Create symlink to chezmoi-managed config
if [ ! -L "$GHOSTTY_DIR/config" ]; then
    ln -sf "$HOME/.config/ghostty/config" "$GHOSTTY_DIR/config"
    echo "✓ Ghostty config symlinked"
fi

# Create symlink to chezmoi-managed themes directory
if [ -d "$HOME/.config/ghostty/themes" ] && [ ! -L "$GHOSTTY_DIR/themes" ]; then
    rm -rf "$GHOSTTY_DIR/themes" 2>/dev/null || true
    ln -sf "$HOME/.config/ghostty/themes" "$GHOSTTY_DIR/themes"
    echo "✓ Ghostty themes symlinked"
fi

{{ end -}}
